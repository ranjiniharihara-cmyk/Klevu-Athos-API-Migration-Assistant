<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klevu to Athos Migration Assistant</title>
    <style>
        :root {
            --klevu-color: #97C73E;
            /* Klevu green */
            --ss-color: #1D4990;
            /* Athos Blue */
            --bg-color: #f4f6f8;
            --code-bg: #2d2d2d;
            --text-color: #333;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 40px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 950px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        /* HEADER & TOGGLE */
        .header {
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            flex-shrink: 0;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--klevu-color);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--ss-color);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .platform-label {
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #888;
            transition: color 0.3s;
            white-space: nowrap;
        }

        .platform-label.active {
            color: #000;
            font-weight: 800;
        }

        /* MAIN CONTENT LAYOUT */
        .main-body {
            display: flex;
            flex: 1;
        }

        /* SIDEBAR NAV */
        .sidebar {
            width: 220px;
            flex-shrink: 0;
            background: #fafafa;
            border-right: 1px solid #eee;
            padding: 20px 0;
            border-bottom-left-radius: 12px;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            font-size: 15px;
            color: #666;
            border-left: 4px solid transparent;
            transition: all 0.2s;
        }

        .nav-item:hover {
            background: #f0f0f0;
        }

        .nav-item.active {
            background: #eef5ff;
            color: var(--ss-color);
            border-left-color: var(--ss-color);
            font-weight: 600;
        }

        /* CONTENT AREA */
        .content {
            flex: 1;
            padding: 30px;
            min-width: 0;
        }

        h2 {
            margin-top: 0;
        }

        /* FIX: Adjusted padding for better flow inside the border line */
        .description-box {
            background: none;
            border-left: 4px solid var(--ss-color);
            padding: 1px 0 0 15px;
            /* Reduced vertical padding */
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 15px;
            line-height: 1.6;
        }

        .klevu-theme .description-box {
            background: none;
            border-left: 4px solid var(--klevu-color);
        }

        /* Style for top-level paragraph inside description-box */
        .description-box>p:first-child {
            margin-top: 15px;
        }

        .code-header {
            font-size: 12px;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
        }

        /* CODE BLOCK STYLING FIXES */
        pre {
            background: var(--code-bg);
            color: #e0e0e0;
            padding: 20px;
            border-radius: 8px;

            /* WRAPPING FIXES */
            white-space: pre-wrap;
            white-space: -moz-pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;

            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 25px;
        }

        .sub-section h3 {
            margin-top: 30px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            color: var(--ss-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            /* Ensure alignment */
        }

        /* FIX: Ensure the text content is wrapped so the link has space on the right */
        .sub-section h3 .heading-content {
            flex-grow: 1;
        }

        /* Style for the link icon container */
        .sub-section h3 .link-placeholder {
            margin-left: 10px;
            flex-shrink: 0;
        }

        .sub-section h3 .link-placeholder a {
            color: var(--ss-color);
            font-size: 0.9em;
            text-decoration: none;
            flex-shrink: 0;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
        }

        .badge.klevu {
            background: var(--klevu-color);
        }

        .badge.ss {
            background: var(--ss-color);
        }

        /* SYNTAX HIGHLIGHTING SIMULATION */
        .key {
            color: #ff7b72;
        }

        .str {
            color: #a5d6ff;
        }

        .com {
            color: #8b949e;
            font-style: italic;
        }

        .num {
            color: #79c0ff;
        }

        /* RESPONSIVE BREAKPOINT */
        @media (max-width: 700px) {
            .main-body {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #eee;
                display: flex;
                overflow-x: auto;
                padding: 0;
            }

            .nav-item {
                white-space: nowrap;
                border-left: none;
                border-bottom: 4px solid transparent;
                padding: 15px 20px;
            }

            .nav-item.active {
                border-left: none;
                border-bottom-color: var(--ss-color);
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            .toggle-container {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="header">
            <h3>Klevu - Athos API Migration Assistant</h3>
            <div class="toggle-container">
                <span class="platform-label active" id="label-klevu">Klevu (Source)</span>
                <label class="switch">
                    <input type="checkbox" id="platformToggle">
                    <span class="slider"></span>
                </label>
                <span class="platform-label" id="label-ss">Athos (Target)</span>
            </div>
        </div>

        <div class="main-body">
            <div class="sidebar">
                <div class="nav-item active" onclick="setSection('autocomplete')">Autocomplete</div>
                <div class="nav-item" onclick="setSection('search')">Search API</div>
                <div class="nav-item" onclick="setSection('category')">Category Pages</div>
                <div class="nav-item" onclick="setSection('recs')">Recommendations</div>
                <div class="nav-item" onclick="setSection('personalization')">Personalization</div>
                <div class="nav-item" onclick="setSection('analytics')">Analytics - not ready</div>
                <div class="nav-item" onclick="setSection('filtering')">Filtering / Advanced Faceting</div>
                <div class="nav-item" onclick="setSection('configs')">Configurations</div>
            </div>

            <div class="content" id="content-area">
            </div>
        </div>
    </div>

    <script>
        // --- BASE DOCS URL (Used for the main footer link) ---
        const BASE_DOCS_URL = 'https://docs.searchspring.com/reference/getting-started-welcome';

        // --- DATA STORE (ALL MAPPINGS) ---
        const data = {
            autocomplete: {
                title: "Autocomplete & Instant Search",
                klevu: {
                    desc: "<p>Klevu handles both the Zero-Term and Typed states using a single endpoint structure. All content (Trending, Products, CMS) is returned in nested arrays within a monolithic response.</p>",
                    code: `
                    <div class="sub-section">
                        <h3>Zero-Term: Trending Queries/Products</h3>
                        <p>Klevu sources trending content from a static config file fetched on load.</p>
                        <pre><code><span class="com">// Klevu Trending Data Source:</span>
GET https://js.klevu.com/klevu-js-v1/klevu-js-api/{apiKey}.json</code></pre>
                    </div>
                    <div class="sub-section">
                        <h3>Zero-Term: Recent Searches/Products</h3>
                        <p>User history is stored and retrieved via the browser's <b>localStorage</b>.</p>
                        <pre><code><span class="com">// Klevu: Uses native browser functions to read/write.</span>
localStorage.getItem('klevu_recent_searches')</code></pre>
                    </div>
                    <div class="sub-section">
                        <h3>Typed Search: Products / CMS / Category / autosuggestions</h3>
                        <p>Sent as a single POST request with multiple objects in the <code>recordQueries</code> array.</p>
                        <pre><code><span class="com">// Klevu: Single Monolithic POST request</span>
POST /cs/v2/search
{
  <span class="key">"recordQueries"</span>: [
      <span class="com">// Object 1: autosuggestion</span>
    { <span class="key">"id"</span>: <span class="str">"autosuggestion"</span>, ... }, 
    <span class="com">// Object 2: Products</span>
    { <span class="key">"id"</span>: <span class="str">"productSearch"</span>, ... }, 
    <span class="com">// Object 3: CMS</span>
    { <span class="key">"id"</span>: <span class="str">"cmsSearch"</span>, <span class="key">"typeOfRecords"</span>: <span class="str">"KLEVU_CMS"</span>, ... }, 
    <span class="com">// Object 4: Category</span>
    { <span class="key">"id"</span>: <span class="str">"categorySearch"</span>, <span class="key">"typeOfRecords"</span>: <span class="str">"KLEVU_CATEGORY"</span>, ... } 
  ]
}</code></pre>
                    </div>
                `
                },
                ss: {
                    desc: "<p>Athos requires Parallel Requests and uses specialized endpoints. Categories and CMS pages are typically indexed in a separate 'Content' Site ID for performance and modularity.</p>",
                    code: `
                    <div class="sub-section">
                        <h3><span class="heading-content">Zero-Term: Trending Searches (Queries)</span> <span class="link-placeholder" data-link="https://docs.searchspring.com/reference/get-trending"></span></h3>
                        <p>Uses a dedicated API for fetching aggregate popular search terms.</p>
                        <pre><code><span class="com">// Athos Trending Queries API:</span>
GET https://{siteId}.a.Athos.io/api/suggest/trending.json
?siteId=<span class="str">{Main_Site_ID}</span></code></pre>
                    </div>
                    <div class="sub-section">
                        <h3><span class="heading-content">Zero-Term: Trending Products</span> <span class="link-placeholder" data-link="https://docs.searchspring.com/reference/get-recommendations"></span></h3>
                        <p>This is a Recommendation API call using a configured Profile Tag.</p>
                        <pre><code><span class="com">// Athos Recommendations API:</span>
GET /boost/recommendations/recommend
?siteId=<span class="str">{Main_Site_ID}</span>
&tags=<span class="str">autocomplete-trending</span></code></pre>
                    </div>
                    <div class="sub-section">
                        <h3><span class="heading-content">Zero-Term: Recent Searches</span></h3>
                        <p>The terms will have to be stored in a local array and retrieved on client side.</p>
                        <pre><code><span class="com">// Athos: Implement logic to read/write search history.</span>
localStorage.setItem('athos_recent_searches', JSON.stringify(terms))</code></pre>
                    </div>
                    <div class="sub-section">
                        <h3><span class="heading-content">Typed Search: Products (Main Index)</span> <span class="link-placeholder" data-link="https://docs.searchspring.com/reference/get-autocomplete"></span></h3>
                        <p>Dedicated Autocomplete endpoint for fast product and term suggestions.</p>
                        <pre><code><span class="com">// Req A: PRODUCTS (Main Site ID)</span>
GET /api/search/autocomplete.json
?siteId=<span class="str">{Main_Site_ID}</span>
&q=<span class="str">boots</span></code></pre>
                    </div>
                    <div class="sub-section">
                        <h3><span class="heading-content">Typed Search: Categories & CMS (Content Index)</span> <span class="link-placeholder" data-link="https://docs.searchspring.com/reference/content-results"></span></h3>
                        <p>Parallel request to the Content Site ID to fetch non-product results for a tabbed view.</p>
                        <pre><code><span class="com">// Req B: CATEGORIES & CMS (Content Site ID)</span>
GET /api/search/autocomplete.json
?siteId=<span class="str">{Content_Site_ID}</span>
&q=<span class="str">boots</span></code></pre>
                    </div>
                    <div class="sub-section">
                        <h3><span class="heading-content">Suggested APIs (Query Suggestions)</span> <span class="link-placeholder" data-link="https://docs.searchspring.com/reference/get-suggest"></span></h3>
                        <p>Dedicated Suggestions API for fetching relevant related terms based on partial user input. More details on how Athos creates suggestions <span class="link-placeholder" data-link="https://help.searchspring.net/hc/en-us/articles/360050241231-How-Autocomplete-suggestions-are-created"></span> </p>
                        <pre><code><span class="com">// Req C: QUERY SUGGESTIONS (Main Site ID)</span>
GET /api/search/suggest.json
?siteId=<span class="str">{Main_Site_ID}</span>
&q=<span class="str">boots</span></code></pre>
                    </div>
                `,
                    docsUrl: BASE_DOCS_URL // Main link for the tab
                }
            },
            search: {
                title: "Product Search & Pagination",
                klevu: {
                    // FIX: Wrapped desc in <p> tag to improve layout and fix margin issue
                    desc: "<p>Klevu uses a <b>POST</b> request with a deep JSON structure. Pagination is handled via <code>offset</code> (0, 10, 20...). Filters are nested objects.</p>",
                    code: `<span class="com">// Klevu Endpoint: POST /cs/v2/search</span>
{
  <span class="key">"context"</span>: {
    <span class="key">"apiKeys"</span>: [<span class="str">"klevu-12345"</span>]
  },
  <span class="key">"recordQueries"</span>: [
    {
      <span class="key">"id"</span>: <span class="str">"searchConfig"</span>,
      <span class="key">"typeOfRequest"</span>: <span class="str">"SEARCH"</span>,
      <span class="key">"settings"</span>: {
        <span class="key">"query"</span>: { <span class="key">"term"</span>: <span class="str">"running shoes"</span> },
        <span class="key">"limit"</span>: <span class="num">24</span>,
        <span class="key">"offset"</span>: <span class="num">0</span> <span class="com">// 0=Page1, 24=Page2</span>
      }
    }
  ]
}`
                },
                ss: {
                    // FIX: Wrapped desc in <p> tag to improve layout and fix margin issue
                    desc: `<p>Athos uses a standard <b>GET</b> request. Pagination uses <code>page</code> numbers (1, 2, 3...). Filters are flattened into query parameters using the <code>filter.field</code> syntax.</p>
					<div style="margin-top: 10px; text-align: right;">
						<a href="https://docs.searchspring.com/reference/get-search" target="_blank" style="color: var(--ss-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
							Search API Documentation ðŸ”—
						</a>
					</div>`,
                    code: `<span class="com">// Athos Endpoint: GET /api/search/search.json</span>

<span class="com">// Query Parameters:</span>
?siteId=<span class="str">abc1234</span>
&q=<span class="str">running shoes</span>
&resultsPerPage=<span class="num">24</span>
&page=<span class="num">1</span> <span class="com">// WARNING: Use 1 for first page, not 0!</span>

<span class="com">// Filtering examples:</span>
&filter.color=<span class="str">Blue</span>
&filter.price_range_custom=<span class="str">100-200</span>`
                },
                docsUrl: BASE_DOCS_URL
            },
            category: {
                title: "Category/Collection Pages",
                klevu: {
                    // FIX: Wrapped desc in <p> tag to improve layout and fix margin issue
                    desc: "<p>Klevu treats categories like search results where the query is <code>*</code> and a <code>categoryPath</code> filter is applied within the JSON payload.</p>",
                    code: `<span class="com">// Klevu: POST /cs/v2/search</span>
{
  <span class="key">"recordQueries"</span>: [
    {
      <span class="key">"settings"</span>: {
        <span class="key">"query"</span>: {
           <span class="key">"term"</span>: <span class="str">"*"</span>,
           <span class="key">"categoryPath"</span>: <span class="str">"Men > Shoes > Running"</span>
        },
        <span class="key">"typeOfRequest"</span>: <span class="str">"CATNAV"</span>
      }
    }
  ]
}`
                },
                ss: {
                    // FIX: Wrapped desc in <p> tag to improve layout and fix margin issue
                    desc: `<p>In Athos, leave the query <code>q=</code> empty, and apply a <b>Background Filter</b>. This loads the merchandising config for that specific category.</p>
					<div style="margin-top: 10px; text-align: right;">
						<a href="https://docs.searchspring.com/reference/category-result-pages" target="_blank" style="color: var(--ss-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
							Category Pages API Documentation ðŸ”—
						</a>
					</div>`,
                    code: `<span class="com">// Athos: GET /api/search/search.json</span>

<span class="com">// Query Parameters:</span>
?siteId=<span class="str">abc1234</span>
&q= <span class="com">// Leave empty for category landing pages</span>
&bgfilter.category_id=<span class="str">6789</span> <span class="com">// Use the unique Category ID</span>

<span class="com">// Alternately, filter by hierarchy string if indexed:</span>
<span class="com">// &bgfilter.hierarchy="Men > Shoes > Running"</span>`
                },
                docsUrl: BASE_DOCS_URL
            },
            recs: {
                title: "Recommendations (Product & Cart)",
                klevu: {
                    desc: "Klevu defines the logic <i>inside the request</i>. You explicitly request <code>RECS_ALSO_VIEWED</code> or <code>RECS_ALSO_BOUGHT</code> in the payload.",
                    code: `<span class="com">// Klevu: POST /cs/v2/search</span>
{
  <span class="key">"recordQueries"</span>: [
    {
       <span class="key">"typeOfRequest"</span>: <span class="str">"RECS_ALSO_VIEWED"</span>,
       <span class="key">"context"</span>: {
         <span class="key">"recentObjects"</span>: [
             { <span class="key">"type"</span>: <span class="str">"product"</span>, <span class="key">"id"</span>: <span class="str">"SKU-123"</span> }
         ]
       }
    }
  ]
}`
                },
                ss: {
                    desc: `Athos uses a POST request for Recommendations API and multiple profiles can be requested in a single call. You configure the rules in the Console and reference them in the payload.
					<div style="margin-top: 10px; text-align: right;">
						<a href="https://docs.searchspring.com/reference/post-recommendations" target="_blank" style="color: var(--ss-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
							Recommendations API Documentation ðŸ”—
						</a>
					</div>
					<hr style="border: 0; border-top: 1px solid #ddd; margin: 15px 0;">
					<p style="font-weight: 600; margin-bottom: 5px;">Note on Payload Structure:</p>
					<p>The <b>Profiles</b> object consists of multiple configurations to specify limit, categories, etc. One is <b>deduping</b>, which prevents the same product from appearing in multiple recommendation profiles within a single batch. This is useful when you have several recommendation profiles on a page and want to ensure a diverse range of products is shown to the shopper.</p>
					<p>The <b>Filters</b> object is used to define filtering configurations (e.g., excluding the current product SKU).</p>`,
                    code: `<span class="com">// Athos Endpoint: POST /boost/recommendations/recommend</span>

{
  <span class="key">"profiles"</span>: [
    {
      <span class="key">"categories"</span>: [
        <span class="str">"Men"</span>
      ],
      <span class="key">"tag"</span>: <span class="str">"Trending"</span>,
      <span class="key">"limit"</span>: <span class="num">10</span>,
      <span class="key">"dedupe"</span>: <span class="key">true</span>
    },
    {
      <span class="key">"tag"</span>: <span class="str">"recently-viewed"</span>,
      <span class="key">"limit"</span>: <span class="num">10</span>,
      <span class="key">"dedupe"</span>: <span class="key">true</span>
    }
  ],
  <span class="key">"filters"</span>: [
    {
      <span class="key">"values"</span>: [
        <span class="str">"abc123"</span>
      ],
      <span class="key">"field"</span>: <span class="str">"sku"</span>,
      <span class="key">"type"</span>: <span class="str">"notEqual"</span>
    }
  ]
}`
                },
                docsUrl: BASE_DOCS_URL
            },

            // --- NEW PERSONALIZATION TAB ---
            personalization: {
                title: "User Personalization & Context",
                klevu: {
                    desc: `<p>With Klevu, the user preferences and browsing history were to be passed in the API request.</p>
                    <div style="margin-top: 10px; text-align: right;">
						<a href="https://docs.klevu.com/apis/personalisation#Xx4Es" target="_blank" style="color: var(--klevu-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
							Klevu Personalization Docs ðŸ”—
						</a>
					</div>`,
                    code: `` // No code block needed
                },
                ss: {
                    desc: `<p>With Athos, personalization is achieved across sessions and is strongly tied to the shopper ID. It is critical to pass the customer details in the recommendation request to display personalized results.</p>
                    <p>It is also important to make a <b>preflight API call</b> with shopper and user ID details before running searches to initialize and enable all personalization features for the current session.</p>
                    <div style="margin-top: 10px; text-align: right;">
						<a href="https://docs.searchspring.com/reference/post-preflight" target="_blank" style="color: var(--ss-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
							Athos Preflight API Docs ðŸ”—
						</a>
					</div>`,
                    code: `` // No code block needed
                },
                docsUrl: 'https://docs.searchspring.com/reference/post-preflight'
            },

            analytics: {
                title: "Analytics & IntelliSuggest Tracking",
                klevu: {
                    desc: "<p>Klevu tracks search and click events via simple GET requests (tracking pixels) to <code>stats.ksearchnet.com</code>. Along with this, it also collects purchase data through an API endpoint.</p>",
                    code: `<span class="com">// Klevu Click Tracking URL</span>
https://stats.ksearchnet.com/analytics/collect
?klevu_apiKey=<span class="str">klevu-123</span>
&klevu_type=<span class="str">clicked</span>
&klevu_productId=<span class="str">SKU-123</span>`
                },
                ss: {
                    desc: `<p>For product-related actions (Search, Click, View), Athos requires <b>Intellisuggest Tracking</b>. This tracking uses parameters returned in the search results (d and s) for session validation.</p>
           <div style="margin-top: 10px; display: flex; flex-direction: column; gap: 8px; align-items: flex-end;"> 
               <a href="https://docs.searchspring.com/reference/intellisuggest_tracking" target="_blank" style="color: var(--ss-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
                   Intellisuggest Tracking Docs ðŸ”—
               </a>
           </div>
           <hr style="border: 0; border-top: 1px solid #ddd; margin: 15px 0;">
           <p>If you are implementing personalization features, you must also implement the dedicated <b>Beacon Tracking</b> POST request.</p>
           <div style="margin-top: 10px; display: flex; flex-direction: column; gap: 8px; align-items: flex-end;"> 
               <a href="https://docs.searchspring.com/reference/post-beacon-1" target="_blank" style="color: var(--ss-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
                   Beacon Tracking (Personalization) Docs ðŸ”—
               </a>
           </div>`,
                    code: `` // Code block intentionally left empty
                },
                docsUrl: BASE_DOCS_URL
            },
            filtering: {
                title: "Faceting & Advanced Filtering ",
                klevu: {
                    // FIX: Wrapped initial descriptive text in <p> tag
                    desc: `<p>Klevu requires the front-end developer to use specific API parameters or structured conditions to control the display and complex behavior of filters (facets) in search and category results.</p>
                <div class="sub-section" style="margin-top: 15px;">
                    <h3>Facet Visibility, Ordering & Limits</h3>
                    <p>Controlling which filters are displayed (visibility), the order in which they appear (ordering), and the number of values shown (limits) is managed by defining them in the APIs.</p>
                    <pre><code><span class="com">// Klevu: Example of controlling which filters are returned and setting limits.</span>
POST /cs/v2/search
{
  <span class="key">"settings"</span>: {
    <span class="key">"query"</span>: { ... },
    <span class="key">"filters"</span>: {
      <span class="key">"filtersToReturn"</span>: {
        <span class="key">"enabled"</span>: <span class="key">true</span>,
        <span class="key">"include"</span>: [
          <span class="str">"category"</span>,
          <span class="str">"brand"</span>,
          <span class="str">"size"</span>
        ],
        <span class="key">"options"</span>: {
          <span class="key">"order"</span>: <span class="str">"INDEX"</span>, <span class="com">// INDEX, COUNT, ALPHABETICAL</span>
          <span class="key">"limit"</span>: <span class="num">5</span> <span class="com">// Limits facet options returned to 5</span>
        }
      }
    }
  }
}</code></pre>
                </div>
                <div class="sub-section">
                    <h3>Advanced Filtering (Group Conditions)</h3>
                    <p>Creating complex logical filters (e.g., brand A AND color blue) requires the developer to submit a structured <code>groupCondition</code> object as part of the search query payload.</p>
                    <pre><code><span class="com">// Klevu: Advanced Filtering (Setting a groupCondition parameter in the request)</span>
{
  <span class="com">// This structure is sent as a parameter in the API request JSON:</span>
  <span class="key">"groupCondition"</span>: {
    <span class="key">"groupOperator"</span>: <span class="str">"ALL_OF"</span>, <span class="com">// ALL_OF, ANY_OF, NONE_OF</span>
    <span class="key">"conditions"</span>: [
        { <span class="key">"key"</span>: <span class="str">"brand"</span>, <span class="key">"valueOperator"</span>: <span class="str">"INCLUDE"</span>, <span class="key">"values"</span>: [<span class="str">"ACME"</span>] }
    ]
  }
}</code></pre>
                    <div style="margin-top: 10px; text-align: right;">
                        <a href="https://docs.klevu.com/apis/advanced-filtering" target="_blank" style="color: var(--klevu-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
                            Klevu Advanced Filtering Docs ðŸ”—
                        </a>
                    </div>
                </div>`,
                    code: `` // Code block intentionally left empty for external rendering via 'desc'
                },
                ss: {
                    desc: `<p>Athos provides more flexibility to the merchandiser so they can define filter behavior, order, and advanced rules. The functionality is entirely controlled via the Merchandising Console.</p>
					<hr style="border: 0; border-top: 1px solid #ddd; margin: 15px 0;">
					<p>Filter rules are added in the Visual Merchandising Console campaign rules.
					<ul>
						<li>Facet Visibility & Ordering: Turn any indexed attribute to a filter and manage the display from the admin.</li>
						<li>Visual Merchandising: Promote key products using Boost Rules or Enhanced Pinning and controll filter ordering per campaign (search term, category, landing page, etc)</li>
					</ul>
					</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 8px; align-items: flex-end;">Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://help.searchspring.net/hc/en-us/articles/201184909-Filtering" target="_blank" style="color: var(--ss-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Filtering Rules Documentation ðŸ”—
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="https://help.searchspring.net/hc/en-us/articles/115000993946-Visual-Merchandising" target="_blank" style="color: var(--ss-color); text-decoration: none; font-weight: 600; font-size: 0.9em;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Visual Merchandising Console Docs ðŸ”—
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`,
                    code: `` // NO CODE BLOCK NEEDED
                },
                docsUrl: 'https://help.searchspring.net/hc/en-us/articles/201184909-Filtering'
            },
            configs: {
                title: "Core Search & Merchandising Configurations",
                klevu: {
                    desc: `<p>Klevu exposes numerous search and category merchandising settings, preferences, and fine-tuning options through its APIs. These configurations are typically managed by the developer directly via the payload structure.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <hr style="border: 0; border-top: 1px solid #ddd; margin: 15px 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p style="font-weight: 600; margin-bottom: 5px;">Key Klevu API Configurations:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Sorting:</b> Defining sorting option in the API.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Pagination:</b> Specify Page size and results per page in API.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Fields:</b> Managed by explicitly listing required product fields in the payload.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Grouping Results:</b> Used to group variants through Name </li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Type of Search:</b> Specify the search type like wildcard match or Fuzzy match.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Search preferences:</b> Settings to fine tune queries.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </ul></p>`,
                    code: `` // No code block needed
                },
                ss: {
                    desc: `<p>Athos generally moves these configurations from the code layer to the Merchandising Console or utilizes simple query parameters, giving more control to the merchandiser.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <hr style="border: 0; border-top: 1px solid #ddd; margin: 15px 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p style="font-weight: 600; margin-bottom: 5px;">Athos Configuration Mapping:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Sorting:</b> Any eligible Indexed attribute can be used as a sorting option, configurable in the admin. This provides more control to the merchandiser.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div style="margin-top: 5px; font-size: 0.9em;"><a href="https://help.searchspring.net/hc/en-us/articles/206986683-Sort-Options" target="_blank" style="color: var(--ss-color); text-decoration: none;">Sort Options Docs ðŸ”—</a></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Pagination:</b> Pagination is defined through the <code>resultsPerPage</code> and <code>page</code> query parameters in the search API call.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Fields:</b> Fields to be returned in the response (display) and fields to be used for search/filters (searchable/filterable) are configured in the Field Settings section.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div style="margin-top: 5px; font-size: 0.9em;"><a href="https://help.searchspring.net/hc/en-us/articles/203776879-4-Managing-Field-Settings" target="_blank" style="color: var(--ss-color); text-decoration: none;">Field Settings Docs ðŸ”—</a></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Grouping Results:</b> Grouping results is not currently available in Athos.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Type of Search:</b> Athos has concepts like Strict Search and Expanded Search, which manage query interpretation.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <li><b>Search preferences:</b> There are no exact configurations in Athos, but handling out-of-stock visibility or deboosting them can be handled through Merchandising Rules. For any other search-specific configurations, please reach out to your PM at the time of implementation.</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </ul></p>`,
                    code: `` // No code block needed
                },
                docsUrl: BASE_DOCS_URL
            }
        };

        // --- STATE MANAGEMENT & RENDERING LOGIC ---
        let currentSection = 'autocomplete';
        let isAthos = false;

        const toggle = document.getElementById('platformToggle');
        const contentArea = document.getElementById('content-area');
        const labelKlevu = document.getElementById('label-klevu');
        const labelSS = document.getElementById('label-ss');
        const navItems = document.querySelectorAll('.nav-item');

        // --- UPDATED RENDER FUNCTION ---
        function render() {
            const sectionData = data[currentSection];
            const platformData = isAthos ? sectionData.ss : sectionData.klevu;
            const platformName = isAthos ? 'Athos' : 'Klevu';
            const badgeClass = isAthos ? 'ss' : 'klevu';

            // **1. Section Link (Appears once at bottom)**
            let docsLinkHTML = '';

            // The main link uses the BASE_DOCS_URL defined globally
            if (isAthos) {
                docsLinkHTML = `<div style="margin-top: 15px; font-size: 14px; text-align: right;">
                                <a href="${BASE_DOCS_URL}" target="_blank" style="color: var(--ss-color); text-decoration: none; font-weight: 600;">
                                    ðŸš€ View Official Athos Docs
                                </a>
                            </div>`;
            }

            // **2. Sub-Block Link Insertion Logic (Only for Autocomplete)**
            let finalCode = platformData.code;

            // Only modify Autocomplete code blocks with the link icon (Autosuggestion logic is handled here)
            if (isAthos) {
                // Regex to find the unique placeholder: <span class="link-placeholder" data-link="URL"></span>
                const linkRegex = /<span class="link-placeholder" data-link="([^"]+)">/g;

                finalCode = finalCode.replace(linkRegex, (match, url) => {
                    if (url) {
                        // The link icon replaces the placeholder span
                        return `<a href="${url}" target="_blank" style="color: var(--ss-color); font-size: 0.9em; text-decoration: none; margin-left: 10px; flex-shrink: 0;">ðŸ”—</a>`;
                    }
                    return ''; // Remove placeholder if URL is missing
                });
            }


            // Update Labels
            labelSS.classList.toggle('active', isAthos);
            labelKlevu.classList.toggle('active', !isAthos);
            contentArea.classList.toggle('klevu-theme', !isAthos);


            // Generate HTML
            let contentHTML;
            if (currentSection === 'autocomplete') {
                contentHTML = finalCode + docsLinkHTML;
            } else {
                // START: Conditional Code Block Rendering Logic
                let codeBlockHTML = '';
                // Only render the code block and header if code exists and is not just whitespace
                if (platformData.code.trim().length > 0) {
                    // Update the REST API label for the Recs tab where it is POST
                    const apiMethod = (currentSection === 'recs' && isAthos) ? 'REST API (POST)' : 'REST API (GET)';

                    codeBlockHTML = `
                        <div class="code-header">
                            <span>Request Format</span>
                            <span>${apiMethod}</span>
                        </div>
                        <pre><code>${finalCode}</code></pre>
                    `;
                }
                // END: Conditional Code Block Rendering Logic

                // For all other simple sections, use the standard template.
                contentHTML = `
                    <div class="description-box">
                        ${platformData.desc}
                    </div>
                    ${codeBlockHTML} 
                    ${docsLinkHTML}
                `;
            }

            contentArea.innerHTML = `
                <span class="badge ${badgeClass}">${platformName} Implementation</span>
                <h2>${sectionData.title}</h2>
                ${contentHTML}
            `;
        }

        // --- EVENT LISTENERS ---
        toggle.addEventListener('change', (e) => {
            isAthos = e.target.checked;
            render();
        });

        function setSection(section) {
            currentSection = section;

            // Update Nav UI
            navItems.forEach((el) => {
                el.classList.remove('active');
                if (el.getAttribute('onclick').includes(section)) {
                    el.classList.add('active');
                }
            });

            render();
        }

        // Initial Render
        navItems.forEach(el => { // Find the initial active item and set currentSection
            if (el.getAttribute('onclick').includes('autocomplete')) {
                el.classList.add('active');
                currentSection = 'autocomplete';
            } else {
                el.classList.remove('active');
            }
        });
        render();

    </script>

</body>

</html>
